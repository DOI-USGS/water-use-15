info:
  id: water-use-15
  name: U.S. Water Use
  date: 2018-06-19
  publish-date: 2018-06-19
  path: water-use-15
  analytics-id: UA-78530187-12
  description: >-
    Water touches almost every aspect of American life: from food to electricity to 
    consumer products. Understanding how we use water is crucial for learning how 
    to be more responsible with water resources. For the first time, the U.S. 
    Geological Survey is displaying the national compilation of water use data for 
    every U.S. county. Explore the variety of water use across the U.S. to understand 
    how we use our current resources.
  keywords:
  audience:
  url: https://owi.usgs.gov/vizlab/water-use-15
  thumbnail-landing:
    url: images/thumb_landing.png
    width: 400
    height: 400
    alttext: "Water Use"
  required-packages:
    vizlab:
      repo: github
      version: 0.3.6
      name: USGS-VIZLAB/vizlab
      ref: v0.3.6
    aws.s3:
      repo: CRAN
      version: 0.3.3
    aws.signature:
      repo: CRAN
      version: 0.3.5
    dataRetrieval:
      repo: CRAN
      version: 2.7.4
    dplyr:
      repo: CRAN
      version: 0.7.0
    geojsonio:
      repo: CRAN
      version: 0.6.0
    googledrive:
      repo: CRAN
      version: 0.1.1
    js:
      repo: CRAN
      version: 1.1
    jsonlite:
      repo: CRAN
      version: 1.5
    maps:
      repo: CRAN
      version: 3.2.0
    maptools:
      repo: CRAN
      version: 0.9-2
    readxl:
      repo: CRAN
      version: 1.0.0
    rgdal:
      repo: CRAN
      version: 1.2-16
    rgeos:
      repo: CRAN
      version: 0.3-26
    sp:
      repo: CRAN
      version: 1.2.6
    sf:
      repo: CRAN
      version: 0.5.4
    sbtools:
      repo: CRAN
      version: 1.1.6
      
  contributors:
    -
      name: Lindsay Carr
      email: lcarr@usgs.gov
      affiliation: U.S. Geological Survey
    -
      name: Alison Appling
      email: aappling@usgs.gov
      affiliation: U.S. Geological Survey
    -
      name: Marty Wernimont
      email: mwernimont@usgs.gov
      affiliation: U.S. Geological Survey
    -
      name: Jordan Read
      email: jread@usgs.gov
      affiliation: U.S. Geological Survey
    -
      name: Laura DeCicco
      email: ldecicco@usgs.gov
      affiliation: U.S. Geological Survey
    -
      name: David Watkins
      email: wwatkins@usgs.gov
      affiliation: U.S. Geological Survey

parameter:
  -
    id: spatial_metadata
    crs: '+init=epsg:4326' # works with d3.geoAlbers
    bbox: [-125, 26, -68, 50] # conus bbox
  -
    id: wu_type_column_names
    orig_names: ["TO-Wtotl", "PT-Wtotl", "PS-Wtotl", "IR-WFrTo", "IN-Wtotl"]
    new_names: ["total", "thermoelectric", "publicsupply", "irrigation", "industrial"]
  - 
    id: social-links
    github: https://github.com/USGS-VIZLAB/water-use-15
    twitter: https://twitter.com/share?url=https://owi.usgs.gov/vizlab/water-use-15/?utm_source=twitter_button_share%2F&text=The%20USGS%20studies%20water%20use%20in%20every%20county%20of%20the%20U.S.%20to%20manage%20current%20resources%20and%20prepare%20for%20future%20needs.%20Explore%20your%20county%20here&hashtags=water,usgs,wateruse
    facebookLink: http://www.facebook.com/sharer.php?u=https://owi.usgs.gov/vizlab/water-use-15/?utm_source=fb_button_share&quote=The%20U.S.%20Geological%20Survey%20studies%20water%20use%20in%20every%20county%20to%20manage%20current%20resources%20and%20prepare%20for%20future%20needs.%20Explore%20your%20county%20and%20learn%20more%20about%20why%20water%20use%20is%20so%20diverse&hashtag=%23wateruse
  -
    id: wu_year
    year: 2010

fetch:
  -
    id: viewbox
    location: cache/viewbox.rds
    reader: rds
    fetcher: viewbox_limits
    scripts: [scripts/fetch/viewbox_limits.R , scripts/fetch/utils.R]
    depends:
      spatial_metadata: spatial_metadata
    comment: sets up the basic view window and projection
  - 
    id: huc4_boundaries_topojson #HUC4
    location: cache/huc4_boundaries.json
    fetch_args:
      google_file_id: "1hNdy_UGthTEw2v7-cx3VFJlKKRzfX3Gx"
    reader: json
    mimetype: application/json
    fetcher: googledrive
    scripts: scripts/fetch/googledrive.R
  -
    id: huc8_boundaries_topojson #HUC8
    location: cache/huc8_boundaries.json
    fetch_args:
      google_file_id: "1lhu11HUPLVU02OWtw04O72z0x1o1udel"
    reader: json
    mimetype: application/json
    fetcher: googledrive
    scripts: scripts/fetch/googledrive.R
  -
    id: huc8_centroids_topojson
    location: cache/huc8_centroids.json
    fetch_args:
      google_file_id: "1fy3cCqcfzZz32u_ODU7LloEwXwk8DWfi"
    reader: json
    mimetype: application/json
    fetcher: googledrive
    scripts: scripts/fetch/googledrive.R
  -
    id: wu_data_county #HUC8
    location: cache/qry_HUC8_WaterUse.txt
    fetch_args:
      google_file_id: "1Mnep5RNz140aBmwimpaPUuMpAkZsTEaP"
    reader: huc_data
    fetcher: googledrive
    scripts: [scripts/read/huc_data.R, scripts/fetch/googledrive.R]
    mimetype: text/tab-separated-values
  - 
    id: wu_data_state #HUC4
    location: cache/qry_HUC4_WaterUse.txt
    fetch_args:
      google_file_id: "1MeU5GLG76SbU3eBRLieTpRAkI0DizOk_"
    reader: huc_data
    fetcher: googledrive
    scripts: [scripts/read/huc_data.R, scripts/fetch/googledrive.R]
    mimetype: text/tab-separated-values
    
process:
  -
    id: wu_data_state_simplify
    location: cache/wu_data_state_simplify.json
    mimetype: application/json
    reader: json
    depends:
      rawdata: wu_data_state
      year: wu_year
    processor: simplify_huc_data
    scripts: [scripts/process/simplify_huc_data.R]
  -
    id: wu_data_county_simplify
    location: cache/wu_data_county_simplify.json
    mimetype: application/json
    reader: json
    depends:
      rawdata: wu_data_county
      year: wu_year
    processor: simplify_huc_data
    scripts: [scripts/process/simplify_huc_data.R]
  -
    id: wu_data_national_sum
    location: cache/wu_data_national_sum.json
    mimetype: application/json
    depends:
      rawdata: wu_data_state_simplify
      col_names: wu_type_column_names
    processor: summarize_wu_data
    scripts: [scripts/process/summarize_wu_data.R] #getting negative 'other'
  -
    id: wu_data_state_sum
    location: cache/wu_state_data.json
    mimetype: application/json
    depends:
      rawdata: wu_data_state_simplify
      state_boundaries: huc4_boundaries_topojson
    processor: state_wu_data
    scripts: [scripts/process/state_wu_data.R]
  -
    id: wu_data_range
    location: cache/wu_data_range.json
    mimetype: application/json
    depends:
      wu_data_yr: wu_data_county_simplify
    processor: find_range_huc
    scripts: [scripts/process/find_range.R]
  -
    id: huc8_centroids_wu_tsv
    location: cache/huc8_centroids_wu.tsv
    mimetype: text/tab-separated-values
    process_args:
      layer: centroids
    depends:
      topo: huc8_centroids_topojson
      wu_data: wu_data_county_simplify
    processor: merge_centroids_wu
    scripts: [scripts/process/merge_centroids_wu.R]

visualize:

publish:
  -
    id: wateruse_page
    name: index
    template: fullpage
    publisher: page
    depends:
      vizlab-favicon: "lib-vizlab-favicon"
      all_css: "all_css"
      header: "header_section"
      mobile_map_ui: "mobile_map_ui"
      map_section: "map_section"
      all_js_minified: "all_js_minified"
      huc4_boundaries: huc4_boundaries_topojson
      huc8_boundaries: huc8_boundaries_topojson
      huc8_centroids_wu: huc8_centroids_wu_tsv
      wu_data_county: wu_data_county_simplify #HUC8
      wu_data_state: wu_data_state_sum #HUC4
      wu_data_national: wu_data_national_sum
      wu_data_range:  wu_data_range
    context:
      resources: ["all_js_minified", "all_css", "vizlab-favicon"]
      sections: ["mobile_map_ui", "map_section"] # adding header and footer here, doubled each on the page
  -
    id: all_js_minified
    location: "js/all.min.js"
    mimetype: application/javascript
    publish_args:
      lib_js: ["lib-d3-js"]
      js_files: [
        "js/topojson.v1.min.js",
        "js/url_hashes.js", "js/custom_projection.js", "js/styles.js", "js/buttons.js",
        "js/resize.js", "js/map_utils.js", "js/states.js", "js/counties.js", "js/watermark.js", 
        "js/circles.js", "js/mobile_ui.js", "js/modernizr_custom.js", "js/lazy_loading.js", 
        #"js/national_pie.js", "js/rank_states_utils.js", 
        "js/scroll_tracking.js", "js/build_map_utils.js"
      ]
      troubleshoot: TRUE
    publisher: combine_minify_js
    scripts: [scripts/publish/combine_minify_js.R]
  -
    id: build_map_minified
    location: "js/build_map.min.js"
    mimetype: application/javascript
    publish_args:
      js_files: ["js/build_map.js"]
      troubleshoot: TRUE
    publisher: combine_minify_js
    scripts: [scripts/publish/combine_minify_js.R]
  -
    id: all_css
    location: "layout/css/all.css"
    mimetype: application/javascript
    publish_args:
      lib_css: ["lib-header-css", "lib-footer-css", "lib-content-css", "lib-social-media-css"]
      custom_css_files: ["layout/css/map.css", "layout/css/custom.css"]
    publisher: combine_css
    scripts: [scripts/publish/combine_css.R]
  -
    id: selectArrows
    location: images/selectArrows.svg
    mimetype: image/svg
    title: "Select Arrows"
    alttext: "Select Input Custom Arrows"
  -
    id: header_section
    template: header-template
    publisher: header
    depends: "lib-header-css"
    context:
      title: "Water use in the U.S., 2015"
  -
    id: map_section
    template: layout/templates/map_section.mustache
    publisher: section
    depends:
      map_script: build_map_minified
    context:
      map_script: map_script
  -
    id: mobile_map_ui
    template: layout/templates/mobileMapUI.mustache
    publisher: section
    depends:
      selectArrows: selectArrows
    context:
      selectArrows: selectArrows
