# Do not edit - automatically generated
# from the task_makefile.mustache template
# by create_task_makefile()

target_default: state_notCONUS_gifs

include:
  - gif_globals.yml

packages:
  - sp
  - maps
  - maptools
  - rgeos
  - readr
  - stringr
  - dataRetrieval
  - lubridate
  - dplyr
  - mapdata
  - jsonlite
  - scipiper

sources:
  - scripts/gifs/map_utils.R
  - scripts/gifs/data_utils.R
  - scripts/gifs/draw_utils.R

file_extensions:
  - "ind"

targets:
  # --- AK --- #
  
  AK_proj:
    command: get_proj(proj_data, I('Alaska'))

  AK_state:
    command: to_sp(I('world'), I(c('USA:alaska')), proj.string = AK_proj)

  AK_state_totals:
    command: get_state_totals('cache/wu_state_data.json', I('Alaska'))

  AK_plot_layout:
    command: get_state_layout(AK_state, plot_metadata)

  AK_county_dots:
    command: get_state_dots('cache/county_centroids_USA.json', 
      'cache/county_centroids_wu.tsv',
      AK_proj, AK_state_totals)

  gifs/AK_water_use.gif.ind:
    command: build_wu_gif(state_sp = AK_state, dots_sp = AK_county_dots, state_totals = AK_state_totals, state_layout = AK_plot_layout, 
      watermark_file = 'images/usgs_logo_black.png', 
      ind_file = target_name, frames = I(5), I('pie'), I('irrigation'), I('thermoelectric'), I('publicsupply'))

  # --- HI --- #
  
  HI_proj:
    command: get_proj(proj_data, I('Hawaii'))

  HI_state:
    command: to_sp(I('world'), I(c('USA:hawaii')), proj.string = HI_proj)

  HI_state_totals:
    command: get_state_totals('cache/wu_state_data.json', I('Hawaii'))

  HI_plot_layout:
    command: get_state_layout(HI_state, plot_metadata)

  HI_county_dots:
    command: get_state_dots('cache/county_centroids_USA.json', 
      'cache/county_centroids_wu.tsv',
      HI_proj, HI_state_totals)

  gifs/HI_water_use.gif.ind:
    command: build_wu_gif(state_sp = HI_state, dots_sp = HI_county_dots, state_totals = HI_state_totals, state_layout = HI_plot_layout, 
      watermark_file = 'images/usgs_logo_black.png', 
      ind_file = target_name, frames = I(5), I('pie'), I('irrigation'), I('thermoelectric'), I('publicsupply'))

  # --- PR --- #
  
  PR_proj:
    command: get_proj(proj_data, I('Puerto Rico'))

  PR_state:
    command: to_sp(I('world2Hires'), I(c('Puerto Rico')), proj.string = PR_proj)

  PR_state_totals:
    command: get_state_totals('cache/wu_state_data.json', I('Puerto Rico'))

  PR_plot_layout:
    command: get_state_layout(PR_state, plot_metadata)

  PR_county_dots:
    command: get_state_dots('cache/county_centroids_USA.json', 
      'cache/county_centroids_wu.tsv',
      PR_proj, PR_state_totals)

  gifs/PR_water_use.gif.ind:
    command: build_wu_gif(state_sp = PR_state, dots_sp = PR_county_dots, state_totals = PR_state_totals, state_layout = PR_plot_layout, 
      watermark_file = 'images/usgs_logo_black.png', 
      ind_file = target_name, frames = I(5), I('pie'), I('irrigation'), I('thermoelectric'), I('publicsupply'))

  # --- VI --- #
  
  VI_proj:
    command: get_proj(proj_data, I('U.S. Virgin Islands'))

  VI_state:
    command: to_sp(I('world2Hires'), I(c('Virgin Islands:Saint Thomas', 'Virgin Islands:Saint John', 'Virgin Islands:Saint Croix')), proj.string = VI_proj)

  VI_state_totals:
    command: get_state_totals('cache/wu_state_data.json', I('U.S. Virgin Islands'))

  VI_plot_layout:
    command: get_state_layout(VI_state, plot_metadata)

  VI_county_dots:
    command: get_state_dots('cache/county_centroids_USA.json', 
      'cache/county_centroids_wu.tsv',
      VI_proj, VI_state_totals)

  gifs/VI_water_use.gif.ind:
    command: build_wu_gif(state_sp = VI_state, dots_sp = VI_county_dots, state_totals = VI_state_totals, state_layout = VI_plot_layout, 
      watermark_file = 'images/usgs_logo_black.png', 
      ind_file = target_name, frames = I(5), I('pie'), I('irrigation'), I('thermoelectric'), I('publicsupply'))

  # --- Overall job --- #

  state_notCONUS_gifs:
    command: sc_indicate(I('gifs/state_notCONUS_gifs.ind'))
    depends: 
      - gifs/AK_water_use.gif.ind
      - gifs/HI_water_use.gif.ind
      - gifs/PR_water_use.gif.ind
      - gifs/VI_water_use.gif.ind
